This code is strongly inspired by Fady Makram.
